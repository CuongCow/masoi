<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Th∆∞ vi·ªán Font Awesome cho bi·ªÉu t∆∞·ª£ng -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Qu·∫£n Tr√≤ Ma S√≥i</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" href="/logo/logoweb-dammekynang.png" type="image/png">
    <link rel="stylesheet" href="/styles.css">
    <style>
        h1 {
            font-family: 'Nosifer', Arial, sans-serif;
            font-size: 3em;
            color: #ffffff;
            margin-top: 8%;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgb(255, 25, 0),
            0 0 20px rgba(231, 76, 60, 0.5);
        }
        .container {
            width: 95%;
            max-width: 1200px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            margin: 20px auto;
        }
        .reset-button, .cancel-button, .button {
            padding: 12px 20px;
            border: none;
            cursor: pointer;
            font-size: 1em;
            width: 100%;
            margin: 10px 0;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        .reset-button {
            background-color: #e74c3c;
            color: white;
        }
        .reset-button:hover {
            background-color: darkred;
        }
        .cancel-button {
            background-color: #ffffff86;
            color: white;
        }
        .cancel-button:hover {
            background-color: #333;
        }
        .button {
            background-color: #2a9d8f;
            color: white;
        }
        .button:hover {
            background-color: #076177;
        }
        .warning-button {
            background-color: orange;
            color: white;
            display: none;
            margin-top: 10px;
        }
        .player-list, .role-list {
            margin-top: 20px;
            background-color: #222222;
            color: #fff;
            padding: 15px;
            border-radius: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #444;
            color: #ffffff;
            font-size: 1em;
        }
        .alive {
            background-color: #2ecc71;
        }
        .dead {
            background-color: #e74c3c;
        }
        .controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        .day-night-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .day-night-buttons button {
            flex: 1;
            min-width: 150px;
            margin: 0;
        }
        input[type="text"], select {
            padding: 10px;
            font-size: 1em;
            width: 100%;
            margin-bottom: 10px;
            color: #222;
            border: none;
            border-radius: 5px;
        }
        .actions-cell {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        .shield-button {
            background-color: #3498db;
            color: white;
        }
        .night-role-list {
            display: none;
            margin-top: 15px;
            padding: 10px;
            background-color: #333;
            border-radius: 5px;
        }
        .role-button {
            background-color: #555;
            color: white;
            padding: 8px 15px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px;
        }
        .role-button.red {
            background-color: red;
        }

        .guide-button {
            margin-top: 20px;
            padding: 10px 30px;
            background-color: #e74c3c;
            color: #fff;
            border: none;
            border-radius: 50px;
            font-size: 1em;
            cursor: pointer;
            text-decoration: none;
        }
        .guide-button:hover {
            background-color: darkred;
        }

        #dayCountdownDisplay {
            background-color: #2a9d8f; /* N·ªÅn m·ªù m√†u ƒëen v·ªõi ƒë·ªô m·ªù 50% */
            color: #fff; /* M√†u ch·ªØ tr·∫Øng ƒë·ªÉ d·ªÖ ƒë·ªçc tr√™n n·ªÅn m·ªù */
            padding: 8px; /* T·∫°o kho·∫£ng c√°ch gi·ªØa vƒÉn b·∫£n v√† vi·ªÅn */
            border-radius: 5px; /* Bo tr√≤n c√°c g√≥c */
            display: inline-block;
        }

        #foolVictoryModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* M√†u n·ªÅn m·ªù */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: #000000;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }
        .potion-button {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            margin: 0 5px;
        }
        /* N·ªôi dung ch√≠nh */
        .content {
            text-align: center;
            color: rgb(0, 0, 0);
            padding: 150px 20px 60px 450px;
        }

        .content h1 {
            font-size: 60px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
        }

        .content p {
            font-size: 20px;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }
        .icon-black {
            color: #000000; /* Set icon color to black */
            margin-top: 5%;
            font-size: 40px;
        }
        

        .content p {
            font-size: 20px;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }


        @media (max-width: 7608px) {

    .content {
            text-align: 10;
            color: rgb(0, 0, 0);
            padding: 100px 50px 60px 24px;
            
        }
    
}


@media (max-width: 768px) {
    h1 {
            font-family: 'Nosifer', Arial, sans-serif;
            font-size: 3em;
            color: #ffffff;
            margin-top: 18%;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgb(255, 25, 0),
            0 0 20px rgba(231, 76, 60, 0.5);
        }
    /* Thay ƒë·ªïi k√≠ch th∆∞·ªõc b·∫£ng cho ƒëi·ªán tho·∫°i */
    #playersTable {
        width: 100%; /* ƒê·∫∑t chi·ªÅu r·ªông b·∫£ng l√† 100% ƒë·ªÉ chi·∫øm to√†n b·ªô chi·ªÅu r·ªông c·ªßa container */
        table-layout: auto; /* T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông c·ªßa c√°c c·ªôt */
    }
    .player-list, .role-list {
            margin-top: 20px;
            background-color: #222222;
            padding: 15px;
            border-radius: 10px;
        }
    body {
        background-size: 100% auto; /* ƒê·∫∑t chi·ªÅu r·ªông n·ªÅn b·∫±ng 100% v√† chi·ªÅu cao t·ª± ƒë·ªông */
        background-position: center; /* ƒê·∫∑t v·ªã tr√≠ n·ªÅn ·ªü gi·ªØa */
        opacity: 1; /* ƒê·ªô m·ªù cho logo, ch·ªânh l·∫°i ƒë·ªÉ ph√π h·ª£p */
    }
    .container {
        width: 150%; /* ƒê·∫∑t chi·ªÅu r·ªông c·ªßa container l·ªõn h∆°n, v√≠ d·ª• 90% */
        max-width: 1200px; /* Gi·ªõi h·∫°n chi·ªÅu r·ªông t·ªëi ƒëa n·∫øu c·∫ßn */
        margin: 0 auto; /* CƒÉn gi·ªØa container */
    }
}



    </style>
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="title-container">
            <div class="menu-icon" id="menuIcon" onclick="toggleSidebar()">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="logo">
                <a href="/index.html" style="text-decoration: none; color: inherit;">
                    ƒêam m√™ K·ªπ nƒÉng
                </a>
            </div>
        </div>
        <div class="header-right">
            <a href="/login.html" class="login-btn" id="loginBtn">ƒêƒÉng nh·∫≠p</a>
            <span id="userDisplay" style="color: white; font-weight: bold; margin-right: 15px;"></span>
            <a href="#" onclick="logout()" class="login-btn" id="logoutBtn" style="display: none;">ƒêƒÉng xu·∫•t</a>
        </div>
    </header>
    <script>
        // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p khi trang ƒë∆∞·ª£c t·∫£i
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = localStorage.getItem('currentUser');
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const userDisplay = document.getElementById('userDisplay');
            
            if (currentUser) {
                // Ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng nh·∫≠p
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'inline-block';
                userDisplay.textContent = `${currentUser}`; // Ch·ªâ hi·ªÉn th·ªã t√™n ng∆∞·ªùi d√πng
            } else {
                // Ch∆∞a ƒëƒÉng nh·∫≠p
                loginBtn.style.display = 'inline-block';
                logoutBtn.style.display = 'none';
                userDisplay.textContent = '';
            }
        });

        function logout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                localStorage.removeItem('currentUser');
                window.location.reload();
            }
        }
        </script>

    <!-- Sidebar Section -->
    <div class="sidebar" id="sidebar">
        <a href="/index.html"><span class="icon">üè†</span>Trang ch·ªß</a>
        <div class="dropdown">
            <div class="dropdown-btn">
                <span class="icon">üì®</span>Tool M·∫≠t Th∆∞<span>‚ñº</span>
            </div>
            <div class="dropdown-content">
                <div class="dropdown-sub">
                    <a href="#" class="has-submenu">Thay th·∫ø</a>
                    <div class="submenu">
                        <a href="/toolmatthu/thaythe/chubangchuen.html">Ch·ªØ = Ch·ªØ EN</a>
                        <a href="/toolmatthu/thaythe/sobangchuen.html">S·ªë = Ch·ªØ EN</a>
                        <a href="/toolmatthu/thaythe/chubangchuvn.html">Ch·ªØ = Ch·ªØ VN</a>
                        <a href="/toolmatthu/thaythe/sobangchuvn.html">S·ªë = Ch·ªØ VN</a>
                        <a href="/toolmatthu/thaythe/khanhhoa.html">Kh√°nh H√≤a</a>
                    </div>
                </div>
                <div class="dropdown-sub">
                    <a href="#" class="has-submenu">T·ªça ƒë·ªô</a>
                    <div class="submenu">
                        <a href="/toolmatthu/toado/10custom.html">10x10 Custom</a>
                        <a href="/toolmatthu/toado/banhangcot.html">B·∫£ng - H√†ng - C·ªôt</a>
                        <a href="/toolmatthu/toado/maphuong.html">Ma Ph∆∞∆°ng</a>
                        <a href="/toolmatthu/toado/phuonghuong.html">Ph∆∞∆°ng h∆∞·ªõng</a>                    </div>
                </div>
                <div class="dropdown-sub">
                    <a href="#" class="has-submenu">D·ªùi ch·ªó</a>
                    <div class="submenu">
                        <a href="/toolmatthu/doicho/camranh.html">CAM RANH</a>
                        <a href="/toolmatthu/doicho/docnguoc.html">ƒê·ªçc Ng∆∞·ª£c</a>
                    </div>
                </div>
                <a href="#">·∫®n d·∫•u</a>
                <a href="#">N√¢ng cao</a>
            </div>
        </div>
        
        <div class="dropdown">
            <div class="dropdown-btn">
                <span class="icon">üê∫</span>Ma S√≥i<span>‚ñº</span>
            </div>
            <div class="dropdown-content">
                <a href="/masoi/quantro.html">ü§µ Qu·∫£n Tr√≤</a>
                <a href="/masoi/huongdan.html">üìú H∆∞·ªõng d·∫´n</a>
            </div>
        </div>
        <div class="dropdown">
            <div class="dropdown-btn">
                <span class="icon">üìñ</span>T√†i li·ªáu<span>‚ñº</span>
            </div>
            <div class="dropdown-content">
                <a href="/tailieu/banxoaymatthu.html">B·∫£n xoay MT</a>
                <a href="/tailieu/matthu.html">M·∫≠t th∆∞</a>
                <a href="/tailieu/muavadanvu.html">M√∫a, d√¢n v≈©</a>
                <a href="/tailieu/nutday.html">N√∫t d√¢y</a>
                <a href="/tailieu/sinhhoatvongtron.html">SH v√≤ng tr√≤n</a>
                <a href="/tailieu/thucongtrai.html">TC tr·∫°i</a>
                <a href="/tailieu/trochoilon.html">Tr√≤ ch∆°i l·ªõn</a>
                <a href="/tailieu/trochoinho.html">Tr√≤ ch∆°i nh·ªè</a>
            </div>
        </div>
        <a href="/lienhe.html"><span class="icon">üìÆ</span> Li√™n h·ªá t√¥i</a>
        <a href="/dieukhoan.html"><span class="icon">üìÑ</span> ƒêi·ªÅu kho·∫£n</a>
    </div>


    <div class="container">
        <h1>Werewolf Game Master</h1>
        <button class="reset-button" onclick="startResetCountdown()">B·∫Øt ƒê·∫ßu L·∫°i</button>
        <span id="countdownDisplay"></span>
        <button class="cancel-button" id="cancelResetButton" onclick="cancelReset()" style="display: none;">H·ªßy</button>

        <div class="controls">
            <input type="text" id="playerName" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i" onkeydown="handleEnter(event)">
            <button class="button" onclick="addPlayer()">Th√™m Ng∆∞·ªùi Ch∆°i</button>
            <select id="roles">
                <option value="Role m·∫∑c ƒë·ªãnh">Role m·∫∑c ƒë·ªãnh</option>
                <option value="Ma S√≥i">Ma S√≥i</option>
                <option value="Ph√π Th·ªßy">Ph√π Th·ªßy</option>
                <option value="B·∫£o V·ªá">B·∫£o V·ªá</option>
                <option value="Ti√™n Tri">Ti√™n Tri</option>
                <option value="Th·∫ßn T√¨nh Y√™u">Th·∫ßn T√¨nh Y√™u</option>
                <option value="B√°n S√≥i">B√°n S√≥i</option>
                <option value="Th·∫±ng Ng·ªë">Th·∫±ng Ng·ªë</option>
                <option value="D√¢n l√†ng">D√¢n l√†ng</option>
            </select>
            <button class="button" onclick="addCustomRole()">Th√™m Role</button>
            <div class="day-night-buttons">
                <button class="button" onclick="startDayCountdown()">B·∫Øt ƒê·∫ßu Ban Ng√†y</button>
                <button class="button" onclick="startNight()">B·∫Øt ƒê·∫ßu Ban ƒê√™m</button>
            </div>
            <span id="dayCountdownDisplay"></span>
            <button class="warning-button" id="dayEndWarning" onclick="alert('Th·ªùi gian ban ng√†y ƒë√£ h·∫øt!')">Th·ªùi Gian Ban Ng√†y ƒê√£ K·∫øt Th√∫c</button>
        </div>

        <div id="nightRoleList" class="night-role-list" style="display: none;">
            <p><strong>L·∫ßn l∆∞·ª£t g·ªçi t√™n c√°c vai tr√≤</strong></p>
        </div>

        <div class="player-list">
            <h2>Danh S√°ch Ng∆∞·ªùi Ch∆°i</h2>
            <table id="playersTable">
                <tr>
                    <th>T√™n Ng∆∞·ªùi Ch∆°i</th>
                    <th>Vai Tr√≤</th>
                    <th>Thao T√°c</th>
                </tr>
            </table>
        </div>
        <div class="role-list">
            <h2>Ghi Ch√∫ Tr√≤ Ch∆°i</h2>
            <ul id="gameLog"></ul>
        </div>

        <div id="foolVictoryModal" style="display: none;">
            <div class="modal-content">
                <h2>Th·∫±ng Ng·ªë Chi·∫øn Th·∫Øng!</h2>
                <p id="foolVictoryMessage"></p>
                <button onclick="startResetCountdown()" class="reset-button">B·∫Øt ƒê·∫ßu L·∫°i</button>
            </div>
        </div>
        
    </div>

    

    <script>
        let players = [];
        let resetTimeout;
        let resetCounter = 10;
        let dayCountdown;
        let dayCounter = 300;
        let lovePair = [];
        const nightRolesOrder = ["Th·∫ßn T√¨nh Y√™u", "B·∫£o V·ªá", "Ma S√≥i", "Ph√π Th·ªßy", "Ti√™n Tri", "B√°n S√≥i", "Th·∫±ng Ng·ªë", "D√¢n l√†ng"];

        function addPlayer() {
            const playerName = document.getElementById('playerName').value;
            if (playerName) {
                const player = {
                    name: playerName,
                    role: "Ch∆∞a g√°n",
                    status: 'S·ªëng',
                    note: "",
                    hasBlackPotion: false,
                    hasWhitePotion: false
                };
                players.push(player);
                document.getElementById('playerName').value = ''; // X√≥a n·ªôi dung √¥ nh·∫≠p sau khi th√™m
                renderPlayers();
                logEvent(`Ng∆∞·ªùi ch∆°i ${playerName} ƒë√£ ƒë∆∞·ª£c th√™m v√†o.`);
            }
        }

        function handleEnter(event) {
            if (event.key === "Enter") {
                addPlayer();
            }
        }

        function addPlayer() {
            const playerName = document.getElementById('playerName').value;
            if (playerName) {
                players.push({ name: playerName, role: "Ch∆∞a g√°n", status: 'S·ªëng', note: "" });
                document.getElementById('playerName').value = ''; // X√≥a n·ªôi dung √¥ nh·∫≠p sau khi th√™m
                renderPlayers();
                logEvent(`Ng∆∞·ªùi ch∆°i ${playerName} ƒë√£ ƒë∆∞·ª£c th√™m v√†o.`);
            }
        }

        function addRole() {
            const newRole = prompt("Nh·∫≠p t√™n role m·ªõi:");
            if (newRole) {
                const roleSelect = document.getElementById('roles');
                const option = document.createElement("option");
                option.value = newRole;
                option.text = newRole;
                roleSelect.add(option);
                logEvent(`Vai tr√≤ m·ªõi "${newRole}" ƒë√£ ƒë∆∞·ª£c th√™m.`);
            }
        }

        function addCustomRole() {
    const newRole = prompt("Nh·∫≠p t√™n role m·ªõi:");
    if (newRole) {
        const roleSelect = document.getElementById('roles');
        
        // Th√™m vai tr√≤ m·ªõi v√†o danh s√°ch ch·ªçn
        const option = document.createElement("option");
        option.value = newRole;
        option.text = newRole;
        roleSelect.add(option);

        // C·∫≠p nh·∫≠t danh s√°ch vai tr√≤ cho ban ƒë√™m
        updateNightRoleList();

        logEvent(`Vai tr√≤ m·ªõi "${newRole}" ƒë√£ ƒë∆∞·ª£c th√™m.`);
    }
}

// H√†m c·∫≠p nh·∫≠t danh s√°ch vai tr√≤ ban ƒë√™m
function updateNightRoleList() {
    const nightRoleList = document.getElementById('nightRoleList');
    nightRoleList.innerHTML = "<p><strong>L·∫ßn l∆∞·ª£t g·ªçi t√™n c√°c vai tr√≤</strong></p>";

    const roleOptions = Array.from(document.getElementById('roles').options).map(option => option.value);
    const uniqueRoles = [...nightRolesOrder, ...roleOptions.filter(role => !nightRolesOrder.includes(role))];

    uniqueRoles.forEach(role => {
        const roleButton = document.createElement("button");
        roleButton.classList.add("role-button");
        roleButton.textContent = role;
        roleButton.onclick = function() {
            roleButton.classList.add("red");
            roleButton.disabled = true;
            checkNightRolesComplete();
        };
        nightRoleList.appendChild(roleButton);
    });
}


        function deletePlayer(playerName) {
            players = players.filter(player => player.name !== playerName);
            renderPlayers();
            logEvent(`Ng∆∞·ªùi ch∆°i ${playerName} ƒë√£ b·ªã x√≥a kh·ªèi tr√≤ ch∆°i.`);
        }


        function changeRole(playerName) {
            const roleSelect = document.createElement("select");
            roleSelect.onchange = function() {
                const selectedRole = roleSelect.value;
                const player = players.find(p => p.name === playerName);
                if (player) {
                    player.role = selectedRole;
                    if (selectedRole === "Ph√π Th·ªßy") {
                        player.hasBlackPotion = true; // C·∫•p b√¨nh thu·ªëc ƒëen
                        player.hasWhitePotion = true; // C·∫•p b√¨nh thu·ªëc tr·∫Øng
                    }
                    renderPlayers();
                    logEvent(`Vai tr√≤ c·ªßa ${playerName} ƒë√£ ƒë∆∞·ª£c ƒë·ªïi th√†nh ${selectedRole}.`);
                    if (selectedRole === "Th·∫ßn T√¨nh Y√™u") {
                        addLoveButtons();
                    }
                }
            };

            const roles = document.getElementById('roles').options;
            for (let i = 0; i < roles.length; i++) {
                const option = document.createElement("option");
                option.value = roles[i].value;
                option.text = roles[i].text;
                roleSelect.add(option);
            }

            const playerRow = document.getElementById(playerName).querySelector('.role-cell');
            playerRow.innerHTML = '';
            playerRow.appendChild(roleSelect);
        }

        function addLoveButtons() {
            players.forEach(player => {
                if (!document.getElementById(`${player.name}-heart`)) {
                    const heartButton = document.createElement("button");
                    heartButton.id = `${player.name}-heart`;
                    heartButton.textContent = "‚ù§Ô∏è";
                    heartButton.onclick = function() {
                        selectLovePair(player.name);
                    };
                    document.getElementById(player.name).querySelector('.actions-cell').appendChild(heartButton);
                }
            });
        }

        function selectLovePair(playerName) {
            if (lovePair.length < 2 && !lovePair.includes(playerName)) {
                lovePair.push(playerName);
                logEvent(`${playerName} ƒë√£ ƒë∆∞·ª£c ch·ªçn l√† m·ªôt n·ª≠a c·ªßa c·∫∑p ƒë√¥i.`);
            }
            if (lovePair.length === 2) {
                logEvent(`C·∫∑p ƒë√¥i ƒë√£ ch·ªçn l√†: ${lovePair[0]} v√† ${lovePair[1]}`);
                // V√¥ hi·ªáu h√≥a t·∫•t c·∫£ c√°c n√∫t tr√°i tim sau khi ch·ªçn c·∫∑p ƒë√¥i
                players.forEach(player => {
                    const heartButton = document.getElementById(`${player.name}-heart`);
                    if (heartButton) heartButton.disabled = true;
                });
                renderPlayers(); // Render l·∫°i danh s√°ch ng∆∞·ªùi ch∆°i ƒë·ªÉ hi·ªÉn th·ªã tr√°i tim b√™n c·∫°nh c·∫∑p ƒë√¥i
            }
        }

        function toggleStatus(playerName) {
            const player = players.find(p => p.name === playerName);
            if (player) {
                player.status = player.status === 'S·ªëng' ? 'Ch·∫øt' : 'S·ªëng';
                renderPlayers();
                logEvent(`Tr·∫°ng th√°i c·ªßa ${playerName} ƒë√£ thay ƒë·ªïi th√†nh ${player.status}.`);
                checkLovePairStatus(playerName);
            }
        }

        function checkLovePairStatus(playerName) {
            if (lovePair.includes(playerName) && players.find(p => p.name === playerName).status === 'Ch·∫øt') {
                const partner = lovePair.find(name => name !== playerName);
                const partnerPlayer = players.find(p => p.name === partner);
                if (partnerPlayer && partnerPlayer.status === 'S·ªëng') {
                    partnerPlayer.status = 'Ch·∫øt';
                    renderPlayers();
                    logEvent(`${partner} ƒë√£ ch·∫øt theo ${playerName} v√¨ l√† c·∫∑p ƒë√¥i.`);
                }
            }
        }

        function renderPlayers() {
            const playersTable = document.getElementById('playersTable');
            playersTable.innerHTML = `<tr>
                <th>T√™n Ng∆∞·ªùi Ch∆°i</th>
                <th>Vai Tr√≤</th>
                <th class="actions-cell">Thao T√°c</th>
            </tr>`;

            players.forEach(player => {
                const rowClass = player.status === 'S·ªëng' ? 'alive' : 'dead';
                const isLovePair = lovePair.includes(player.name) ? " ‚ù§Ô∏è" : ""; // Th√™m tr√°i tim n·∫øu l√† c·∫∑p ƒë√¥i
                playersTable.innerHTML += `<tr id="${player.name}" class="${rowClass}">
                    <td>${player.name}${isLovePair}</td>
                    <td class="role-cell">${player.role}</td>
                    <td class="actions-cell">
                        <button onclick="toggleStatus('${player.name}')">Gi·∫øt</button>
                        <button onclick="changeRole('${player.name}')">ƒê·ªïi Role</button>
                        <button onclick="deletePlayer('${player.name}')">X√≥a</button>
                    </td>
                </tr>`;
            });
        }

        function updateNote(playerName, note) {
            const player = players.find(p => p.name === playerName);
            if (player) {
                player.note = note;
            }
        }

        function startResetCountdown() {
            resetCounter = 30;
            document.getElementById("countdownDisplay").textContent = `Sau ${resetCounter} gi√¢y s·∫Ω reset t·ª´ ƒë·∫ßu`;
            document.getElementById("cancelResetButton").style.display = "inline-block";

                // ·∫®n modal chi·∫øn th·∫Øng n·∫øu c√≥
            document.getElementById("foolVictoryModal").style.display = "none";

            resetTimeout = setInterval(() => {
                resetCounter--;
                document.getElementById("countdownDisplay").textContent = `Sau ${resetCounter} gi√¢y s·∫Ω reset t·ª´ ƒë·∫ßu`;

                if (resetCounter === 0) {
                    clearInterval(resetTimeout);
                    resetRolesAndStatus();
                }
            }, 1000);
        }

        function cancelReset() {
            clearInterval(resetTimeout);
            document.getElementById("countdownDisplay").textContent = "";
            document.getElementById("cancelResetButton").style.display = "none";
            logEvent("ƒê·∫∑t l·∫°i ƒë√£ b·ªã h·ªßy.");
        }

        function resetRolesAndStatus() {
            players.forEach(player => {
                player.role = "Ch∆∞a g√°n";
                player.status = "S·ªëng";
            });
            lovePair = [];
            protectedPlayer = null;
            hasBlackPotion = true; // ƒê·∫∑t l·∫°i b√¨nh thu·ªëc ƒëen
            hasWhitePotion = true; // ƒê·∫∑t l·∫°i b√¨nh thu·ªëc tr·∫Øng

            renderPlayers();
            document.getElementById("gameLog").innerHTML = "";
            document.getElementById("countdownDisplay").textContent = "";
            document.getElementById("cancelResetButton").style.display = "none";
            logEvent("To√†n b·ªô tr√≤ ch∆°i ƒë√£ ƒë·∫∑t l·∫°i.");
        }

        function startDayCountdown() {
            dayCounter = 300;
            document.getElementById("dayEndWarning").style.display = "none";
            document.getElementById("dayCountdownDisplay").textContent = `Th·ªùi gian ban ng√†y: ${Math.floor(dayCounter / 60)}:${String(dayCounter % 60).padStart(2, '0')}`;
            
            dayCountdown = setInterval(() => {
                dayCounter--;
                document.getElementById("dayCountdownDisplay").textContent = `Th·ªùi gian ban ng√†y: ${Math.floor(dayCounter / 60)}:${String(dayCounter % 60).padStart(2, '0')}`;

                if (dayCounter === 0) {
                    clearInterval(dayCountdown);
                    document.getElementById("dayEndWarning").style.display = "inline-block";
                    logEvent("Th·ªùi gian ban ng√†y ƒë√£ k·∫øt th√∫c!");
                }
            }, 1000);
        }

        function startNight() {
            updateNightRoleList(); // C·∫≠p nh·∫≠t danh s√°ch vai tr√≤ ban ƒë√™m
            const nightRoleList = document.getElementById('nightRoleList');
            nightRoleList.innerHTML = "<p><strong>L·∫ßn l∆∞·ª£t g·ªçi t√™n c√°c vai tr√≤</strong></p>"; // Add the note dynamically
            nightRoleList.style.display = "block";

            const roleOptions = Array.from(document.getElementById('roles').options).map(option => option.value);
            const uniqueRoles = [...nightRolesOrder, ...roleOptions.filter(role => !nightRolesOrder.includes(role))];

            uniqueRoles.forEach(role => {
                const roleButton = document.createElement("button");
                roleButton.classList.add("role-button");
                roleButton.textContent = role;
                roleButton.onclick = function() {
                    roleButton.classList.add("red");
                    roleButton.disabled = true;
                    checkNightRolesComplete();
                };
                nightRoleList.appendChild(roleButton);
            });
        }

        function checkNightRolesComplete() {
            const roleButtons = document.querySelectorAll(".role-button");
            const allRed = Array.from(roleButtons).every(button => button.classList.contains("red"));
            if (allRed) {
                setTimeout(() => {
                    document.getElementById("nightRoleList").style.display = "none";
                }, 500);
            }
        }

        function logEvent(event) {
            const gameLog = document.getElementById('gameLog');
            const logEntry = document.createElement('li');
            logEntry.textContent = event;
            gameLog.appendChild(logEntry);
        }

let protectedPlayer = null; // Bi·∫øn ƒë·ªÉ l∆∞u ng∆∞·ªùi ch∆°i ƒë∆∞·ª£c b·∫£o v·ªá

function renderPlayers() {
    const playersTable = document.getElementById('playersTable');
    playersTable.innerHTML = `<tr>
        <th>T√™n Ng∆∞·ªùi Ch∆°i</th>
        <th>Vai Tr√≤</th>
        <th class="actions-cell">Thao T√°c</th>
    </tr>`;

    players.forEach(player => {
        const rowClass = player.status === 'S·ªëng' ? 'alive' : 'dead';
        const isLovePair = lovePair.includes(player.name) ? " ‚ù§Ô∏è" : ""; // Th√™m tr√°i tim n·∫øu l√† c·∫∑p ƒë√¥i
        const isProtected = player.name === protectedPlayer ? " üõ°Ô∏è" : ""; // Th√™m chi·∫øc khi√™n n·∫øu ƒë∆∞·ª£c b·∫£o v·ªá
        
                // Bi·ªÉu t∆∞·ª£ng b√¨nh thu·ªëc cho "Ph√π Th·ªßy"
        const witchActions = player.role === "Ph√π Th·ªßy" && player.status === 'S·ªëng' ? `
            ${player.hasBlackPotion ? `<button onclick="useBlackPotion('${player.name}')" class="potion-button" title="Gi·∫øt">‚ò†Ô∏è</button>` : ""}
            ${player.hasWhitePotion ? `<button onclick="useWhitePotion('${player.name}')" class="potion-button" title="C·ª©u">üöë</button>` : ""}
        ` : "";

        playersTable.innerHTML += `<tr id="${player.name}" class="${rowClass}">
            <td>${player.name}${isLovePair}${isProtected}</td>
            <td class="role-cell">${player.role}</td>
            <td class="actions-cell">
                <button onclick="toggleStatus('${player.name}')">Gi·∫øt</button>
                <button onclick="changeRole('${player.name}')">ƒê·ªïi Role</button>
                ${player.role === "B·∫£o V·ªá" ? '<button onclick="activateShield()" class="shield-button">üõ°Ô∏è</button>' : ""}
                ${witchActions}
                <button onclick="deletePlayer('${player.name}')">X√≥a</button>
            </td>
        </tr>`;
    });
}

let hasBlackPotion = true; // Ki·ªÉm so√°t tr·∫°ng th√°i b√¨nh thu·ªëc ƒëen
let hasWhitePotion = true; // Ki·ªÉm so√°t tr·∫°ng th√°i b√¨nh thu·ªëc tr·∫Øng

function useBlackPotion(witchName) {
    const witchPlayer = players.find(p => p.name === witchName);
    if (!witchPlayer || !witchPlayer.hasBlackPotion) return; // N·∫øu ƒë√£ d√πng b√¨nh thu·ªëc ƒëen th√¨ tho√°t

    const targetName = prompt("Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i b·∫°n mu·ªën gi·∫øt:");
    const targetPlayer = players.find(p => p.name === targetName && p.status === 'S·ªëng');
    
    if (targetPlayer) {
        targetPlayer.status = 'Ch·∫øt';
        witchPlayer.hasBlackPotion = false; // B√¨nh thu·ªëc ƒëen kh√¥ng c√≤n sau khi d√πng
        renderPlayers();
        logEvent(`Ph√π Th·ªßy ${witchName} ƒë√£ gi·∫øt ${targetName} b·∫±ng b√¨nh thu·ªëc ƒëen.`);
        hasBlackPotion = false; // B√¨nh thu·ªëc ƒëen kh√¥ng c√≤n sau khi d√πng
    } else {
        alert("Ng∆∞·ªùi ch∆°i kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ ch·∫øt.");
    }
}

function useWhitePotion(witchName) {
    const witchPlayer = players.find(p => p.name === witchName);
    if (!witchPlayer || !witchPlayer.hasWhitePotion) return; // N·∫øu ƒë√£ d√πng b√¨nh thu·ªëc tr·∫Øng th√¨ tho√°t
    const targetName = prompt("Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i b·∫°n mu·ªën h·ªìi sinh:");

    const targetPlayer = players.find(p => p.name === targetName && p.status === 'Ch·∫øt');
    if (targetPlayer) {
        targetPlayer.status = 'S·ªëng';
        witchPlayer.hasWhitePotion = false; // B√¨nh thu·ªëc tr·∫Øng kh√¥ng c√≤n sau khi d√πng
        renderPlayers();
        logEvent(`Ph√π Th·ªßy ${witchName} ƒë√£ h·ªìi sinh ${targetName} b·∫±ng b√¨nh thu·ªëc tr·∫Øng.`);
        hasWhitePotion = false; // B√¨nh thu·ªëc tr·∫Øng kh√¥ng c√≤n sau khi d√πng
    } else {
        alert("Ng∆∞·ªùi ch∆°i kh√¥ng h·ª£p l·ªá ho·∫∑c ƒëang s·ªëng.");
    }
}


function activateShield() {
    const selectedPlayer = prompt("Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i m√† B·∫£o V·ªá mu·ªën b·∫£o v·ªá:");
    const player = players.find(p => p.name === selectedPlayer);
    if (player && player.status === 'S·ªëng') {
        protectedPlayer = player.name;
        logEvent(`${protectedPlayer} ƒë√£ ƒë∆∞·ª£c b·∫£o v·ªá b·ªüi B·∫£o V·ªá.`);
        renderPlayers(); // C·∫≠p nh·∫≠t l·∫°i danh s√°ch ng∆∞·ªùi ch∆°i ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng khi√™n
    } else {
        alert("Ng∆∞·ªùi ch∆°i kh√¥ng h·ª£p l·ªá ho·∫∑c kh√¥ng t·ªìn t·∫°i.");
    }
}

function toggleStatus(playerName) {
    const player = players.find(p => p.name === playerName);
    if (player) {
        if (player.status === 'S·ªëng' && playerName === protectedPlayer) {
            logEvent(`${playerName} ƒë√£ ƒë∆∞·ª£c b·∫£o v·ªá v√† kh√¥ng b·ªã ch·∫øt.`);
            protectedPlayer = null; // Reset b·∫£o v·ªá sau khi d√πng
        } else if (player.role === 'B√°n S√≥i' && player.status === 'S·ªëng') {
            player.role = 'Ma S√≥i';
            logEvent(`${playerName} t·ª´ b√°n s√≥i ƒë√£ bi·∫øn ƒë·ªïi th√†nh Ma S√≥i v√† ƒë∆∞·ª£c s·ªëng l·∫°i.`);
        } else {
            player.status = player.status === 'S·ªëng' ? 'Ch·∫øt' : 'S·ªëng';
            renderPlayers();
            logEvent(`Tr·∫°ng th√°i c·ªßa ${playerName} ƒë√£ thay ƒë·ªïi th√†nh ${player.status}.`);
            checkLovePairStatus(playerName);
        }
    }
    renderPlayers(); // C·∫≠p nh·∫≠t l·∫°i danh s√°ch ng∆∞·ªùi ch∆°i ƒë·ªÉ hi·ªÉn th·ªã thay ƒë·ªïi
}

function startDayCountdown() {
    dayCounter = 300;
    document.getElementById("dayEndWarning").style.display = "none";
    document.getElementById("dayCountdownDisplay").textContent = `Th·ªùi gian ban ng√†y: ${Math.floor(dayCounter / 60)}:${String(dayCounter % 60).padStart(2, '0')}`;
    
    dayCountdown = setInterval(() => {
        dayCounter--;
        document.getElementById("dayCountdownDisplay").textContent = `Th·ªùi gian ban ng√†y: ${Math.floor(dayCounter / 60)}:${String(dayCounter % 60).padStart(2, '0')}`;

        if (dayCounter === 0) {
            clearInterval(dayCountdown);
            document.getElementById("dayEndWarning").style.display = "inline-block";
            logEvent("Th·ªùi gian ban ng√†y ƒë√£ k·∫øt th√∫c!");
        }
    }, 1000);
    
    // Reset b·∫£o v·ªá v√†o ƒë·∫ßu ng√†y m·ªõi
    protectedPlayer = null;
    logEvent("B·ªô ƒë·∫øm ng∆∞·ª£c 5 ph√∫t th·ªùi gian ban ng√†y b·∫Øt ƒë·∫ßu.");
}

function toggleStatus(playerName) {
    const player = players.find(p => p.name === playerName);
    if (player) {
        if (player.status === 'S·ªëng' && playerName === protectedPlayer) {
            logEvent(`${playerName} ƒë√£ ƒë∆∞·ª£c b·∫£o v·ªá v√† kh√¥ng b·ªã ch·∫øt.`);
            protectedPlayer = null; // Reset b·∫£o v·ªá sau khi d√πng
        } else if (player.role === 'B√°n S√≥i' && player.status === 'S·ªëng') {
            player.role = 'Ma S√≥i';
            logEvent(`${playerName} t·ª´ b√°n s√≥i ƒë√£ bi·∫øn ƒë·ªïi th√†nh Ma S√≥i v√† ƒë∆∞·ª£c s·ªëng l·∫°i.`);
        } else {
            player.status = player.status === 'S·ªëng' ? 'Ch·∫øt' : 'S·ªëng';
            renderPlayers();
            logEvent(`Tr·∫°ng th√°i c·ªßa ${playerName} ƒë√£ thay ƒë·ªïi th√†nh ${player.status}.`);
            checkLovePairStatus(playerName);

            // Ki·ªÉm tra n·∫øu vai tr√≤ l√† "Th·∫±ng Ng·ªë" v√† ng∆∞·ªùi ch∆°i b·ªã gi·∫øt
            if (player.role === "Th·∫±ng Ng·ªë" && player.status === "Ch·∫øt") {
                displayFoolVictory(playerName);
            }
        }
    }
    renderPlayers(); // C·∫≠p nh·∫≠t l·∫°i danh s√°ch ng∆∞·ªùi ch∆°i ƒë·ªÉ hi·ªÉn th·ªã thay ƒë·ªïi
}

// H√†m hi·ªÉn th·ªã th√¥ng b√°o "Th·∫±ng Ng·ªë Chi·∫øn Th·∫Øng"
function displayFoolVictory(playerName) {
    document.getElementById("foolVictoryMessage").textContent = `Ng∆∞·ªùi ch∆°i ${playerName} (Th·∫±ng Ng·ªë) ƒë√£ chi·∫øn th·∫Øng!`;
    document.getElementById("foolVictoryModal").style.display = "flex";
}


    </script>
    <script>
        // Toggle Sidebar and Menu Icon Animation
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const menuIcon = document.getElementById('menuIcon');
            sidebar.classList.toggle('active');
            menuIcon.classList.toggle('active');
        }

        // Dropdown functionality
        const dropdownButtons = document.querySelectorAll('.dropdown-btn');
        dropdownButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const parent = btn.parentElement;
                parent.classList.toggle('active');
            });
        });
        document.addEventListener('click', (event) => {
    const sidebar = document.getElementById('sidebar');
    const menuIcon = document.getElementById('menuIcon');

    // Check if the click is outside the sidebar and the menu button
    if (!sidebar.contains(event.target) && !menuIcon.contains(event.target)) {
        sidebar.classList.remove('active');
        menuIcon.classList.remove('active');
    }
    // L·∫•y t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ c√≥ class 'has-submenu'
const submenuTriggers = document.querySelectorAll('.has-submenu');

submenuTriggers.forEach(trigger => {
    trigger.addEventListener('click', function (e) {
        e.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª <a>

        // L·∫•y ph·∫ßn t·ª≠ cha (dropdown-sub) v√† toggle class 'active'
        const parent = this.parentElement;
        parent.classList.toggle('active');

        // ƒê√≥ng c√°c submenu kh√°c n·∫øu c·∫ßn
        submenuTriggers.forEach(item => {
            if (item !== this) {
                item.parentElement.classList.remove('active');
            }
        });
    });
});

});

</script>
<!-- Th√™m modal v√†o body -->
<div class="modal-overlay" id="modalOverlay"></div>
<div class="login-modal" id="loginModal">
    <h3>Th√¥ng b√°o ƒëƒÉng nh·∫≠p</h3>
    <p>B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ d√πng c√°c c√¥ng c·ª• tool. V√¨ m·ªôt s·ªë l√Ω do c·ªông ƒë·ªìng n√™n r·∫•t c·∫ßn thi·∫øt ƒë·ªÉ qu·∫£n l√Ω ng∆∞·ªùi d√πng.</p>
    <div class="modal-buttons">
        <a href="/login.html" class="modal-btn modal-login">ƒêƒÉng nh·∫≠p</a>
        <a href="/register.html" class="modal-btn modal-register">ƒêƒÉng k√Ω</a>
    </div>
</div>
<script>
    // Th√™m h√†m ki·ªÉm tra ƒëƒÉng nh·∫≠p v√† hi·ªÉn th·ªã modal
    function showLoginModal() {
        document.getElementById('modalOverlay').style.display = 'block';
        document.getElementById('loginModal').style.display = 'block';
    }

    // C·∫≠p nh·∫≠t c√°c event listener cho menu items
    document.addEventListener('DOMContentLoaded', function() {
        const currentUser = localStorage.getItem('currentUser');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userDisplay = document.getElementById('userDisplay');
        
        // Th√™m event listeners cho c√°c menu items c·∫ßn b·∫£o v·ªá
        const protectedMenuItems = document.querySelectorAll('.dropdown-content a[href*="thaythe"], .dropdown-content a[href*="doicho"], .dropdown-content a[href*="toado"]');
        
        protectedMenuItems.forEach(item => {
            if (!currentUser) {
                // Th√™m icon kh√≥a v√† class locked
                item.classList.add('locked-item');
                item.innerHTML += ' <span class="lock-icon">üîí</span>';
                
                // Thay th·∫ø href b·∫±ng javascript:void(0)
                item.setAttribute('href', 'javascript:void(0)');
                
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    showLoginModal();
                });
            }
        });

        // ƒê√≥ng modal khi click b√™n ngo√†i
        document.getElementById('modalOverlay').addEventListener('click', function() {
            this.style.display = 'none';
            document.getElementById('loginModal').style.display = 'none';
        });
        
        if (currentUser) {
            loginBtn.style.display = 'none';
            logoutBtn.style.display = 'inline-block';
            userDisplay.textContent = `${currentUser}`;
        } else {
            loginBtn.style.display = 'inline-block';
            logoutBtn.style.display = 'none';
            userDisplay.textContent = '';
        }
    });
</script>
</body>
</html>
